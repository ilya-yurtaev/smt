var app=app||{};!function(){"use strict";function a(a){return $(a).get()[0]}function b(a){a.preventDefault(),a.stopPropagation()}function c(b){b.length>1&&(React.unmountComponentAtNode(a(b)),$(b).empty())}var d={string:"text",datetime:"datetime",integer:"number","boolean":"checkbox"},e=React.createClass({displayName:"Table",mixins:[Backbone.React.Component.mixin],getInitialState:function(){return{form:"hidden"}},cellClicked:function(a){a.target},create_cell:function(a,b){return React.DOM.td({className:b,onClick:this.cellClicked},a)},create_th:function(a){return React.DOM.th({className:a.type,scope:"col"},a.verbose_name)},create_thead:function(){var a=this.schema.fields;return React.DOM.tr(null,_.map(a,this.create_th))},create_row:function(a){return React.DOM.tr({key:a.id,"data-url":a.resource_uri},_.map(a,this.create_cell))},create_inputs:function(a,b){if("id"!=b&&"resource_uri"!=b){var c="id_"+b;return React.DOM.p(null,React.DOM.label({"for":c},a.verbose_name),React.DOM.input({id:c,type:d[a.type]}))}},toggle_form:function(){this.setState({form:"visible"==this.state.form?"hidden":"visible"}),$("#modelform").toggle()},handleSubmit:function(a){b(a),alert($(a.target).serializeArray())},render:function(){this.schema=this.props.schema;var a="Добавить элемент ";return a+="visible"==this.state.form?"-":"+",React.DOM.div(null,React.DOM.table({id:"data-table"},React.DOM.thead(null,this.create_thead()),React.DOM.tbody(null,this.props.collection.map(this.create_row))),React.DOM.p(null,React.DOM.span({className:"link",onClick:this.toggle_form},a)),React.DOM.form({method:"post",id:"modelform",action:this.props.root_url,className:this.state.form,onSubmit:this.handleSubmit},React.DOM.fieldset(null,_.map(this.schema.fields,this.create_inputs)),React.DOM.p({"class":"submit"},React.DOM.input({type:"submit",value:"Добавить"}))))}}),f=React.createClass({displayName:"Menu",getInitialState:function(){return{path:app.build_url(app.current_collection)}},switchCollection:function(a){this.setState({path:a.target.href.split("#")[1]})},create_link:function(a,b){var c=app.build_url(b),d=~c.indexOf(this.state.path)?"active":"";return React.DOM.li(null,React.DOM.a({id:b,"data-model":b,onClick:this.switchCollection,className:d,href:c},a))},render:function(){return React.DOM.ul(null,_.map(this.props.links,this.create_link))}});app.render_templates=function(){app.render_menu(),app.render_table(app.get_current_collection())},app.render_menu=function(){React.renderComponent(f({links:app.routes}),a("#menu"))},app.render_table=function(b){c("#data"),React.renderComponent(e({collection:b,schema:b.schema,root_url:b.url}),a("#data")),$(".hidden").hide(),$("input[type=datetime]").datepicker({dateFormat:"yy-mm-dd"})}}();