var app=app||{};!function(){"use strict";app.root_url="/test_task/api/v1/",app._requests=0,app.models={},app.routes={},app.collections={},app.exclude_fields=["resource_uri"],app.current_collection=void 0,app.FIELD_MAP={string:"text",datetime:"datetime",integer:"number","boolean":"checkbox"},app.get_field_type=function(a){return app.FIELD_MAP[a]},app.set_title=function(a){document.title=a},app.get_current_collection=function(){return app.collections[app.current_collection]},app.build=function(a){var b=a.resource_name,c=Backbone.Model.extend({urlRoot:a.url,attributes:a.schema.fields});a.model=c,a.parse=function(a){return this.meta=a.meta,a.objects};var d=Backbone.PageableCollection.extend(a);app.routes[b]=a.verbose_name_plural,app.collections[b]=new d([],{state:{firstPage:0,currentPage:0},queryParams:{currentPage:"offset",pageSize:"limit"}})},app.switch_collection=function(a){app.current_collection=a;var b=app.get_current_collection();app.set_title(b.verbose_name_plural),b.fetch(),app.render_table(b)},app.set_initial_collection=function(a){void 0===app.current_collection&&(app.current_collection=a)},app.build_router=function(){var a=Backbone.Router.extend({routes:{":collection":"switchCollection"},switchCollection:function(a){app.switch_collection(a)}});app.router=new a},app.inflect=function(a){return app.get_current_collection().schema.inflections[a]},app.pluralize=function(a,b){var c=b[0],d=b[1],e=b[2],f=a%100,g=a%10;return f>10&&20>f?e:g>1&&5>g?d:1===g?c:e},app.init=function(){$.getJSON(app.root_url,function(a){var b=_.after(_.keys(a).length,app.mount);_.each(a,function(a,c){app.set_initial_collection(c),$.getJSON(a.schema,function(d){app.build({url:a.list_endpoint,resource_name:c,schema:d,verbose_name:d.verbose_name,verbose_name_plural:d.verbose_name_plural}),b()})})})},app.build_url=function(a){return"#"+a},app.mount=function(){app.build_router(),Backbone.history.start(),app.router.navigate(app.build_url(app.current_collection),{trigger:!0}),app.render_menu()},app.init()}();