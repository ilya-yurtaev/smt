var app=app||{};!function(){"use strict";app.root_url="/test_task/api/v1/",app._requests=0,app.models={},app.routes={},app.collections={},app.current_collection=void 0,app.set_title=function(a){document.title=a},app.get_current_collection=function(){return app.collections[app.current_collection]},app.build=function(a){var b=a.resource_name,c=Backbone.Model.extend({});a.model=c,a.parse=function(a){return a.objects};var d=Backbone.Collection.extend(a);app.routes[b]=a.verbose_name_plural,app.models[b]=c,app.collections[b]=new d},app.switch_collection=function(a){app.current_collection=a;var b=app.get_current_collection();app.set_title(b.verbose_name_plural),b.fetch(),app.render_table(b)},app.set_initial_collection=function(a){void 0===app.current_collection&&(app.current_collection=a)},app.build_router=function(){var a=Backbone.Router.extend({routes:{"model/:id":"switchCollection"},switchCollection:function(a){app.switch_collection(a)}});app.router=new a},app.observe=function(a){app._requests+=a,0===app._requests&&$.event.trigger("requests_completed")},app.init=function(){function a(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}var b=$.cookie("csrftoken");$.ajaxSetup({beforeSend:function(c,d){a(d.type)||this.crossDomain||c.setRequestHeader("X-CSRFToken",b)}}),$.getJSON(app.root_url,function(a){app.observe(Object.keys(a).length),$.each(a,function(a,b){app.set_initial_collection(a),$.getJSON(b.schema,function(c){app.build({url:b.list_endpoint,resource_name:a,schema:c,verbose_name:c.verbose_name,verbose_name_plural:c.verbose_name_plural}),app.observe(-1)})})})},app.build_url=function(a){return"#/model/"+a},app.mount=function(){app.build_router(),Backbone.history.start(),app.render_menu()},app.init()}(),$(document).on("requests_completed",app.mount);